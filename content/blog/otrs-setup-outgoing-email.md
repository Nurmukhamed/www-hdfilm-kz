---
layout: post
title: Настройка исходящей почты для OTRS
date: '2020-06-16 12:30:30 +0600'
comments: true
published: true
categories:
- linux
- centos
- postfix
- yandex
- dkim
- spf
---

**Настройка исходящей почты для OTRS** <!--more-->

Имеется домашний сервер, подключенный к сети IDNET Kazakhtelecom, адреса выдаются динамически. На сервере установлена и настроена OTRS. Прием входящих сообщений не вызывает трудностей.
Проблемы с исходящими серверами.

# Проблема №1

Был настроен postfix как null-client, затем была добавлен relayhost на yandex. Для отсылки был использован аккаунт support@edenprime.kz. Но yandex запрещает производить авторизацию под одним емайлом (например, support@edenprime.kz), а письма отправлять под другим емайлом (например, sales@edenprime.kz). Также OTRS создает сообщения с заголовком "Return-Path: <>", которое очень не любит Yandex.

# Проблема №2

Для OTRS был скачен модуль MultiSMTP, для каждого аккаунта был настроен свой smtp-сервер. Все работает, можно получать письма на support@edenprime.kz, отсылать от имени support@edenprime.kz. Также и с другими аккаунтами, которые были созданы. Но есть проблема, если OTRS нужно отправить письмо от аккаунта, которого нет в MultiSMTP, то OTRS использует системные настройки. Которые у меня не были прописаны.

# Проблема №3

Я решил удалить модуль MultiSMTP, отправку почты поручить postfix. Для этого нужно настроить spf, dkim-записи для домена edenprime.kz. spf-запись разрешает отправку с любого почтового сервера и любой А-записи, отправку с остальных мест запрещена. Была добавлена новая dkim-запись otrs._defaultkey, на сервере был установлен opendkim, настроена подпись исходящих сообщений.

Для gmail-сообщения работают, не помечаются как спам, но вот другие почтовые сервера все равно помечают письма как спам. **Хотя возможно, из-за недоступности milter opendkim, письма уходят без подписи и поэтому улетают в спам**



