name: FTP Deploy
on:
  push:
    branches:
      - master  # Set a branch to deploy
    paths:
      - "content/**"
      - "config.toml"
jobs:
  ftp-deploy:
    runs-on: ubuntu-latest
    environment: "FTP Deploy"
    steps:
      - name: üõí Checkout
        uses: actions/checkout@v3

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.111.3'

      - name: Build
        run: hugo --minify

      - name: üì¶ Get LFTP
        run: sudo apt -qq -y install lftp

      - name: üõ†Ô∏è Configure LFTP
        run: |
          mkdir ~/.lftp
          echo "set ssl:ca-file ~/.lftp/certs.crt;set ssl:check-hostname no;" >> ~/.lftp/rc
          echo "${{ secrets.FTP_CERTS_BASE64 }}" | base64 --decode > ~/.lftp/certs.crt

      - name: üìÅ Upload Folder
        env:
          FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
          FTP_HOSTNAME: ${{ secrets.FTP_HOSTNAME }}
        run: lftp -u "${FTP_USERNAME}, ${FTP_PASSWORD}" ${FTP_HOSTNAME} -e "mirror --parallel=100 -R ./public/ /; bye"
