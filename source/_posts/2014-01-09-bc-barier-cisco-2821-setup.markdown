---
layout: post
title: "Настройка Cisco 2821 в связке с Астериск и АТС Siemens HiPath"
date: 2014-01-09 17:14:56 +0600
comments: true
categories: 
- cisco
- voip
- siemens hipath
- asterisk
- KazakhTelecom
- E1 
---

<!-- more -->

Данная статья описывает мой опыт настройки роутера cisco 2821 c 6 Е1-потоками, подключенные к АТС Сименс и ДКП Казахтелеком. "Не правильные пчелы дают не правильный мед", я самоучка и настройку cisco я проходил в спешке и по google. сейчас оглядываясь назад, я понимаю, что многие вещи можно было сделать еще лучше и красивее и быстрее. но к сожалению, прошлого не вернуть.


Что у нас есть в наличие


* 2 Е1-канала от ДКП Казахтелеком
* АТС Siemens HiPath 300 c 8 Е1-потоками
* Сервер Elastix
* Роутер Cisco 2821 c платами на 6 E1-потоков
* Транк до SIP-сервера sip.utel.kz


Подключения


* 4 Е1-потока от АТС Siemens подключены к роутеру Cisco 2821
* 2 Е1-потока от ДКП Казахтелекома подключены к роутеру Cisco 2821
* Сервер Elastix и роутер Cisco 2821 работают по sip протоколу
* Сервер Elastix связан транком с SIP-сервером sip.utel.kz


Как должно работать 


* ДКП Казахтелекома
	* Входящие звонки отправляются на сервер Elastix
	* Исходящие звонки отправлются в потоки Е1 ДКП Казахтелекома
* АТС Siemens
	* Входящие звонки отправляются в потоки Е1 Сименса
	* Исходящие звонки отправляются на сервер Elastix

Я перепробывал много вариантов правильной настройки роутера Cisco и все они были не правильными. в конце концов, в один день я узнал что можно делать преобразование номеров сразу на интерфейсе(транкгруппе), после этого мой конфиг значительно уменьшился, стал понятнее и меньше грузить роутер.


Логика работы

Маршруты


На потоки ДКП Телеком назначены группа номеров, при входящем вызове, вызов должен уйти на сервер Elastix, 


Транкгруппы

Создадим 2 trunkgroup - siemens, telecom. в siemens добавим 4 Е1 потоки подключенные к Siemens, в telecom 2 Е1 потока подключенные к ДКП Телеком

Преобразование в trunkgroup


* ДКП Казахтелекома
	* входящие вызовы
		* делаем преобразование номера, добавляем 1137 к номеру
	* исходящие вызовы
		* делаем преобразование номера, убираем 1139 от номера
* АТС Siemens
	* входящие вызовы
		* нет преобразовании 
	* исходящие вызовы
		* делаем преобразование номера, добавляем 1138 к номеру

Диал-пиры

все соединения отправляются на Elastix сервер. согласно диалплану на Elastix происходит обработка вызов, и вызов отправляется обратно на cisco, где либо уходит в город, либо уходит на АТС



