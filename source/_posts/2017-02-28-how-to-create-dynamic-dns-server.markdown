---
layout: post
title: 'Идея - как реализовать свой динамический днс сервер'
date: '2017-02-28 12:30:30 +0600'
comments: true
published: true
categories:
  - dns
  - ddns
  - yandex dns api
  - github
  - travis-ci
  - gpg
---

В голову пришла идея - как реализовать свой динамический днс сервер, используя доступные услуги.
<!--more-->

## Предыстория

У меня с 2005 года были домашние сервера. Для них я использовал различные ddns-решения бесплатные. Но потом эти услуги либо закрылись, либо стали платными. В последнее время я использую Yandex DNS API для своего домашнего сервера. Открыл домен homeserver.kz, разместил в Yandex. Для обновления использую скрипт, который нашел в интернете. 

Но есть одна проблема. Допустим, у меня и моего брата есть домашние сервера. Я создаю две dns-записи для себя и брата, использую один скрипт для обновления записей. Оба сервера мне подконтрольны. А что делать, если кто-либо попросил меня создать третью запись? Ведь всем трем серверам придется использовать один токен с полным доступом к доменным записям.

Я думал как решить данный вопрос и раньше. Теперь придумал, как это все реализовать безопасным образом.

## Описание

Участники процесса обновления днс-записей:

- домашний сервер ( может быть любой другой компьютер);
- репозитарий на github;
- сервис Travis-CI, подключенный к репозитарию;
- сервис Yandex DNS API
- ключи gpg для безопасного обмена сообщениями.

Алгоритм работы:
- ****Домашний сервер****
	- получает свой внешний ip-адрес;
	- загружает (push) себе репозитарий с гитхаба;
	- изменяет файл serverA.homeserver.kz (предположение);
	- записывает в файл зашифрованный текст - ip-адрес;
	- выгружает (pull) репозитарий в гитхаб;
- ****Github****
	- получив изменения от сервера, вызывает сервис Travis-CI;
- ****Travis-CI****
	- запускает докер-контейнер;
	- настраивает gpg;
    - находит измененные файлы;
    - проверяет, кто создал файл;
    - проверяет, что текст файла - только ip-адрес
    - вызывает скрипт обновления днс-записи в Yandex DNS API;
- ****Yandex DNS****
	- производит обновление записи;
    
Вот от руки нарисовал как должен работать алгоритм

{% img https://s3-eu-west-1.amazonaws.com/images.hdfilm.kz/dynamic_dns_yandex_github_travis_ci.jpg %}

****TODO****

- функционал Домашнего Сервера;
- функционал на стороне Travis-CI;
